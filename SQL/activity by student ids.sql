/* Getting big picture activity by student, from a list of student ids.
   Initially designed to be used with the exit survey data.
   One row per student - subject enrolment.

   Run on stats schema
 */



 select u.student_id as id, u.firstname, u.lastname,
        cm.course_id, cm.course_name,
        act.logins, act.minutes,
        cu.last_access_date, cu.enrollment_date, cu.row_status
from users u
    inner join course_users cu on u.pk1 = cu.users_pk1
    inner join course_main cm on cu.crsmain_pk1 = cm.pk1
    inner join (
        select user_pk1, course_pk1, sum(course_access_minutes) as minutes, count(initial_datetime_access) as logins
        from ods_aa_course_activity
            inner join users u on u.pk1 = ods_aa_course_activity.user_pk1
        where student_id = any(array[ -- paste student id's below, in single quotes
        '11733669','11745071','11570217','11565770','11746055','86120815','11594827','11657352','11746796','11578964','11707893','11658278','11729998','11552662','11554084','11728089','11481407','11744929','11736512','11733586','11750287','95049928','11748391','11748058','95032266','11591199','11681719','11514588','11744598','11517617','11749809','11736529','11427973','11242528','11751030','95044895','11750576','11683780','11623261','11741004','11744194','11632342','11746820','11736016','11745208','11723817','11742838','11730690A','11582392','11748117','11537295','11624019','11750578','11730793','11703054','11750181','11751222','11679931','11737325','11646214','11751506','11471312','11591465','95044270','11743841','11751361','11448591','11748242','11707609','11740461','11751072','11741239','11743810','11743951','11224372','11629219','11728967','11658751','11746162','11746499','11717111','11720252','11576840','11752033','11732054','11600267','94065719','11741352','11716115','11394596','11604622','11232071','11742244','11741814','11672156','11512476','11747559','11742685','11739523','11741664','11748023','11269710','11750508','11725571','11358256','11714697','95053897','11743218','11737044','11618913','11746998','11537819B','11750544','11751783','11705902','11738948','11729351','11742310','11175778','11184411','11204724','11278204','11398743','11480114','11481890','11483577','11516515','11571083','11575648','11609599','11622288','11629678','11642514','11650697','11651492','11655358','11665605','11666152','11678534','11679176B','11684115','11686513','11691806','11693412','11702316','11703699','11708126','11719808','11723637','11726975','11729172','11730342A','11731005','11731386','11734373','11737728','69100758','95041549'

        ])
        group by user_pk1, course_pk1
    ) act
        on act.user_pk1 = u.pk1 and act.course_pk1 = cm.pk1
where role = 'S' and u.student_id is not null and course_id like 'S-%'

